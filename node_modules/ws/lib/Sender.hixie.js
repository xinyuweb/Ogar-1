function Sender(t){if(this instanceof Sender==!1)throw new TypeError("Classes can't be function-called");events.EventEmitter.call(this),this.socket=t,this.continuationFrame=!1,this.isClosed=!1}var events=require("events"),util=require("util"),EventEmitter=events.EventEmitter;module.exports=Sender,util.inherits(Sender,events.EventEmitter),Sender.prototype.send=function(t,e,i){if(!this.isClosed){var r="string"==typeof t,n=r?Buffer.byteLength(t):t.length,o=n>127?2:1,s=0==this.continuationFrame,a=!e||!("undefined"!=typeof e.fin&&!e.fin),f=new Buffer((s?e&&e.binary?1+o:1:0)+n+(!a||e&&e.binary?0:1)),h=s?1:0;s&&(e&&e.binary?(f.write("","binary"),o>1&&f.write(String.fromCharCode(128+n/128),h++,"binary"),f.write(String.fromCharCode(127&n),h++,"binary")):f.write("\x00","binary")),r?f.write(t,h,"utf8"):t.copy(f,h,0),a?(e&&e.binary||f.write("ÿ",h+n,"binary"),this.continuationFrame=!1):this.continuationFrame=!0;try{this.socket.write(f,"binary",i)}catch(c){this.error(c.toString())}}},Sender.prototype.close=function(t,e,i,r){if(!this.isClosed){this.isClosed=!0;try{this.continuationFrame&&this.socket.write(new Buffer([255],"binary")),this.socket.write(new Buffer([255,0]),"binary",r)}catch(n){this.error(n.toString())}}},Sender.prototype.ping=function(t,e){},Sender.prototype.pong=function(t,e){},Sender.prototype.error=function(t){return this.emit("error",t),this};