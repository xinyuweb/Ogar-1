function Teams(){Mode.apply(this,Array.prototype.slice.call(arguments)),this.ID=1,this.name="Teams",this.decayMod=1.5,this.packetLB=50,this.haveTeams=!0,this.colorFuzziness=32,this.teamAmount=3,this.colors=[{r:223,g:0,b:0},{r:0,g:223,b:0},{r:0,g:0,b:223}],this.nodes=[]}var Mode=require("./Mode");module.exports=Teams,Teams.prototype=new Mode,Teams.prototype.fuzzColorComponent=function(o){return o+=Math.random()*this.colorFuzziness>>0},Teams.prototype.getTeamColor=function(o){var e=this.colors[o];return{r:this.fuzzColorComponent(e.r),b:this.fuzzColorComponent(e.b),g:this.fuzzColorComponent(e.g)}},Teams.prototype.onPlayerSpawn=function(o,e){e.color=this.getTeamColor(e.team),o.spawnPlayer(e)},Teams.prototype.onServerInit=function(o){for(var e=0;e<this.teamAmount;e++)this.nodes[e]=[];for(var e=0;e<o.clients.length;e++){var t=o.clients[e].playerTracker;this.onPlayerInit(t),t.color=this.getTeamColor(t.team);for(var s=0;s<t.cells.length;s++){var n=t.cells[s];n.setColor(t.color),this.nodes[t.team].push(n)}}},Teams.prototype.onPlayerInit=function(o){o.team=Math.floor(Math.random()*this.teamAmount)},Teams.prototype.onCellAdd=function(o){this.nodes[o.owner.getTeam()].push(o)},Teams.prototype.onCellRemove=function(o){var e=this.nodes[o.owner.getTeam()].indexOf(o);-1!=e&&this.nodes[o.owner.getTeam()].splice(e,1)},Teams.prototype.onCellMove=function(o,e,t){for(var s=t.owner.getTeam(),n=t.getSize(),i=0,r=0,a=0;a<t.owner.visibleNodes.length;a++){var m=t.owner.visibleNodes[a];if(!(0!=m.getType()||t.owner==m.owner||t.nodeId<=m.nodeId&&m.owner.disconnect<=-1||t.ignoreCollision||m.ignoreCollision)&&m.owner.getTeam()==s){var l=m.getSize(),p=n+l;if(!t.simpleCollide(o,e,m,p))continue;if(dist=t.getDist(o,e,m.position.x,m.position.y),dist<p){var h=m.position.y-e,d=m.position.x-o,c=Math.atan2(d,h),u=Math.max(Math.ceil(Math.max(n,l)/2),360),f=Math.min(p-dist,u),g=f*t.mass/(t.mass+m.mass),y=f-g,T=Math.sin(c),v=Math.cos(c);m.position.x+=g*T>>0,m.position.y+=g*v>>0,i+=y*-T,r+=y*-v}}}t.position.x+=i,t.position.y+=r},Teams.prototype.updateLB=function(o){for(var e=0,t=[],s=0;s<this.teamAmount;s++){t[s]=0;for(var n=0;n<this.nodes[s].length;n++){var i=this.nodes[s][n];i&&(t[s]+=i.mass,e+=i.mass)}}for(var s=0;s<this.teamAmount;s++)0>=e||(o.leaderboard[s]=t[s]/e)};