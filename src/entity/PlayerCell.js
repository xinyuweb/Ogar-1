function PlayerCell(){Cell.apply(this,Array.prototype.slice.call(arguments)),this.cellType=0,this.recombineTicks=0,this.shouldRecombine=!1,this.ignoreCollision=!1,this.restoreCollisionTicks=0}var Cell=require("./Cell");module.exports=PlayerCell,PlayerCell.prototype=new Cell,PlayerCell.prototype.visibleCheck=function(i,o){if(this.mass<100)return this.collisionCheck(i.bottomY,i.topY,i.rightX,i.leftX);var t=this.getSize(),e=t+i.width>>0,s=t+i.height>>0;return this.abs(this.position.x-o.x)<e&&this.abs(this.position.y-o.y)<s},PlayerCell.prototype.calcMergeTime=function(i){var o=!1;if(0==i)o=!0;else{var t=Math.floor(i+.02*this.mass);this.recombineTicks>t&&(o=!0)}this.shouldRecombine=o},PlayerCell.prototype.calcMove=function(i,o,t){var e=t.config,s=this.getSize(),l=o-this.position.y,n=i-this.position.x,r=Math.atan2(n,l);if(!isNaN(r)){for(var h=this.getDist(this.position.x,this.position.y,i,o),a=Math.min(this.getSpeed(),h),p=this.position.x+a*Math.sin(r),c=this.position.y+a*Math.cos(r),y=0,d=0,C=0;C<this.owner.cells.length;C++){var m=this.owner.cells[C];if(!(this.nodeId<=m.nodeId||this.ignoreCollision||m.ignoreCollision||m.shouldRecombine&&this.shouldRecombine)){var g=m.getSize(),u=s+g+5;if(!this.simpleCollide(p,c,m,u))continue;if(h=this.getDist(p,c,m.position.x,m.position.y),u>h){var f=m.position.y-c,M=m.position.x-p,v=Math.atan2(M,f),b=Math.max(Math.ceil(Math.max(s,g)/2),360),P=Math.min(u-h,b),x=P*this.mass/(this.mass+m.mass),T=P-x,R=Math.sin(v),k=Math.cos(v);m.position.x+=x*R>>0,m.position.y+=x*k>>0,y+=T*-R,d+=T*-k}}}var w=this.position.x,S=this.position.y;t.gameMode.onCellMove(p,c,this),p+=y+(this.position.x-w),c+=d+(this.position.y-S),t.gameMode.onCellMove(p,c,this),p<e.borderLeft+s/2&&(p=e.borderLeft+s/2),p>e.borderRight-s/2&&(p=e.borderRight-s/2),c<e.borderTop+s/2&&(c=e.borderTop+s/2),c>e.borderBottom-s/2&&(c=e.borderBottom-s/2),this.position.x=p>>0,this.position.y=c>>0}},PlayerCell.prototype.getEatingRange=function(){return.4*this.getSize()},PlayerCell.prototype.onConsume=function(i,o){i.addMass(this.mass)},PlayerCell.prototype.onAdd=function(i){i.nodesPlayer.push(this),i.gameMode.onCellAdd(this)},PlayerCell.prototype.onRemove=function(i){var o;o=this.owner.cells.indexOf(this),-1!=o&&this.owner.cells.splice(o,1),o=i.nodesPlayer.indexOf(this),-1!=o&&i.nodesPlayer.splice(o,1),i.gameMode.onCellRemove(this)},PlayerCell.prototype.moveDone=function(i){this.ignoreCollision=!1},PlayerCell.prototype.abs=function(i){return 0>i?-i:i},PlayerCell.prototype.getDist=function(i,o,t,e){var s=t-i;s*=s;var l=e-o;return l*=l,Math.sqrt(s+l)},PlayerCell.prototype.onAutoMove=function(i){this.restoreCollisionTicks>0&&(this.restoreCollisionTicks--,this.restoreCollisionTicks<=0&&(this.ignoreCollision=!1))};